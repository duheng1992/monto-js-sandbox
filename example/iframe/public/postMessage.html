<!DOCTYPE html>
<html>

<script type="module">
  import { IframeSandbox } from '/dist/index.esm.js';

  const origin = `http://localhost:4444`;

  const scriptText = `
    const btn = window.document.createElement('button');
    btn.innerText = '我是 iframe， 点我向父容器通信';
    window.document.body.appendChild(btn);

    btn.addEventListener('click', () => {
      if (window.parent?.postMessage) {
        window.parent.postMessage('message to iframe', '${origin}');
      }
    });

    window.addEventListener("message", function (event) {
    if (window == event.source) {
      return
    }

    if (event.origin === origin) {
      console.log('Message from parent:', event.data);
    }
  });
  `;

  const sb = new IframeSandbox({
    rootElm: document.body,
    id: 'iframe-test',
  });

  sb.active(scriptText);

  // 父容器接受
  window.addEventListener("message", function (event) {
    if (window == event.source) {
      return
    }

    if (event.origin === origin) {
      console.log('Message from iframe:', event.data);
      if (event.source) {
        event.source.postMessage('callback message from iframe', origin)
      }
    }
  });
</script>

</html>